import streamlit as st
from tensorflow.keras.models import load_model
from sklearn.preprocessing import StandardScaler
import pandas as pd
import numpy as np

# Load the trained model
model = load_model('my_model.h5')

# Load the scaler
scaler = StandardScaler()  # You need to save your scaler in the training script and load it here.

st.title('Malware Detection Using Permission Requirements (Team 9 Submission)')

# Upload the input file
uploaded_file = st.file_uploader("Upload a file with the permissions list", type="csv")
if uploaded_file is not None:
    # Read the input data from the uploaded file
    input_data = pd.read_csv(uploaded_file)
    input_data = input_data.apply(pd.to_numeric, errors='coerce')

    # Handle NaN values - this will depend on your specific use case
    # Here, we simply replace NaNs with 0
    input_data = input_data.fillna(0)
    # Normalize the input data
    # inputs_normalized = scaler.transform(input_data)
    inputs_normalized = input_data
    print(inputs_normalized)
    # Make prediction
    prediction = model.predict(inputs_normalized)

    # Show prediction
    st.write('Prediction value:', prediction[0])
    if prediction[0] > 0.5:
        st.write('This app is likely malicious.')
    else:
        st.write('This app is likely safe.')